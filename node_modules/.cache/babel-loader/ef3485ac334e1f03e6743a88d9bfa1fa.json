{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\nguye\\\\Downloads\\\\New folder\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\nguye\\\\Downloads\\\\New folder\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\nguye\\\\Downloads\\\\New folder\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\nguye\\\\Downloads\\\\New folder\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\nguye\\\\Downloads\\\\New folder\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\nguye\\\\Downloads\\\\New folder\\\\src\\\\components\\\\Test\\\\menu.js\";\nimport React, { Component } from 'react';\nimport { idScence } from './index.js';\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport { withFirebase } from '../../server/Firebase/index';\nimport $ from 'jquery';\nimport MetisMenu from 'metismenu/src';\nimport './clara.css';\nimport { Button } from \"reactstrap\";\nimport claraService from \"./Clara\";\nimport { ClaraPlayer } from \"./ClaraPlayer\";\nimport sced from './utils';\nvar clara;\nvar sceneId = \"921754c6-d081-4e97-af23-178124591393\"; //clara.sceneIO.fetchAndUse(sceneId);\n\nvar importSceneId = 'f85ef7a2-6aaa-4333-ba69-1e8f121c4706';\nvar mouseID = \"\";\nvar groupId = \"\";\nvar THREE = \"\";\nvar groupIdAttachIdsMap = {};\nvar attachPointLocation = {};\nvar bed = [];\nvar bedimg = [];\nvar chair = [];\nvar sofa = [];\nvar kit = [];\nvar result = [];\n\nvar Menu =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Menu, _Component);\n\n  function Menu(props) {\n    var _this;\n\n    _classCallCheck(this, Menu);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Menu).call(this, props));\n    _this.clara = React.createRef();\n    _this.canvas = React.createRef();\n    _this.state = {\n      items: [],\n      clara: clara\n    };\n    return _this;\n  }\n\n  _createClass(Menu, [{\n    key: \"handleClick\",\n    value: function handleClick(id) {\n      importSceneId = id;\n      importScene();\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var itemsRef = this.props.firebase.database.ref('itemImg');\n      itemsRef.on('value', function (snapshot) {\n        var result;\n        var furnitures = snapshot.val();\n        var newState = [];\n\n        for (var item in furnitures) {\n          var furni = furnitures[item];\n\n          for (var i in furni) {\n            newState.push({\n              name: i,\n              id: furni[i].id,\n              img: furni[i].img\n            });\n          }\n        }\n\n        var claraContainerRef = _this2.refs.ref1;\n        clara = claraService.claraplayer(claraContainerRef); //var api = claraplayer('player');\n\n        THREE = clara.deps.THREE;\n        var rotate = \"\";\n        var opts = {\n          displayGizmo: false,\n          mode: 'plane',\n          plane: {\n            normal: {\n              x: 0,\n              y: 1,\n              z: 0\n            },\n            constant: 0\n          }\n        };\n        clara.player.setProgressBar('line'); //This function is for moving object\n\n        console.log(window.sced);\n        sceneId = window.sced;\n        clara.sceneIO.fetchAndUse(sceneId).then(function () {\n          clara.player.showTool('nodeMove');\n          clara.player.removeTool('select');\n          clara.selection.setHighlighting(true);\n          clara.commands.addCommand({\n            enabled: true,\n            active: true,\n            tool: {\n              click: function click(ev) {\n                var selectId = clara.player.filterNodesFromPosition(ev);\n                console.log(selectId);\n                groupId = findParentGroupId(selectId[0]);\n                mouseID = JSON.stringify(groupId);\n\n                if (!selectId || !groupId) {\n                  clara.selection.deselectAll();\n                  clara.commands.activateCommand('orbit');\n                } else {\n                  clara.selection.selectNode(groupId);\n                  console.log('this is object id: ', groupId);\n                  clara.commands.activateCommand('nodeMove');\n                  opts.onChange = updateAttachPointPosition(groupId);\n                  clara.commands.setCommandOptions('nodeMove', opts);\n                }\n              }\n            }\n          });\n        });\n\n        _this2.setState({\n          items: newState,\n          clara: clara\n        });\n      });\n      $('#menu').metisMenu({\n        toggle: false\n      });\n    } //save\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      result = this.state.items;\n\n      for (var i in result) {\n        if (result[i].name.includes(\"bed\")) {\n          bed.push(result[i]);\n        } else if (result[i].name.includes(\"sofa\")) {\n          sofa.push(result[i]);\n        } else if (result[i].name.includes(\"kit\")) {\n          kit.push(result[i]);\n        } else if (result[i].name.includes(\"chair\")) {\n          chair.push(result[i]);\n        }\n      }\n\n      var count = 0;\n      var cha = 0;\n      var sof = 0;\n      var ki = 0;\n      return React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, \"Home Page\"), React.createElement(\"div\", {\n        id: \"container\",\n        style: {\n          width: \"800px\",\n          height: \"600px\"\n        },\n        ref: \"ref1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }), React.createElement(Button, {\n        className: \"btn\",\n        variant: \"primary\",\n        type: \"button\",\n        onClick: function onClick() {\n          importScene();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, \"Import\"), React.createElement(Button, {\n        className: \"btn\",\n        variant: \"primary\",\n        type: \"button\",\n        onClick: function onClick() {\n          rotateFunc();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, \"Rotate\"), React.createElement(Button, {\n        className: \"btn\",\n        variant: \"primary\",\n        type: \"button\",\n        onClick: function onClick() {\n          scaleFunc();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, \"Scale\"), React.createElement(Button, {\n        className: \"btn\",\n        variant: \"primary\",\n        type: \"button\",\n        onClick: function onClick() {\n          clearScene();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"Delete\"), React.createElement(Button, {\n        variant: \"primary\",\n        type: \"button\",\n        onClick: function onClick() {\n          saveRender();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, \"Download\")), React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }), React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, \"This is a demo\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col-xs-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }, React.createElement(\"aside\", {\n        className: \"sidebar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(\"nav\", {\n        className: \"sidebar-nav\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, React.createElement(\"ul\", {\n        className: \"metismenu\",\n        id: \"menu\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      }, React.createElement(\"li\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        href: \"#\",\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, \"Bed \", React.createElement(\"span\", {\n        className: \"fa arrow\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      })), React.createElement(\"ul\", {\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        maxColumns: 3,\n        \"aria-expanded\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, bed.map(function (data) {\n        if (count > 2) {\n          count = 0;\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 229\n            },\n            __self: this\n          });\n        }\n\n        count++;\n        return React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232\n          },\n          __self: this\n        }, \" \", React.createElement(\"img\", {\n          src: data.img,\n          onClick: function onClick(e) {\n            return _this3.handleClick(data.id);\n          },\n          width: 50,\n          height: 50,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232\n          },\n          __self: this\n        }));\n      })))), React.createElement(\"li\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        href: \"#\",\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, \"Chair \", React.createElement(\"span\", {\n        className: \"fa arrow\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      })), React.createElement(\"ul\", {\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        maxColumns: 3,\n        \"aria-expanded\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }, chair.map(function (data) {\n        if (cha > 2) {\n          cha = 0;\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 245\n            },\n            __self: this\n          });\n        }\n\n        cha++;\n        return React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 248\n          },\n          __self: this\n        }, \" \", React.createElement(\"img\", {\n          src: data.img,\n          onClick: function onClick(e) {\n            return _this3.handleClick(data.id);\n          },\n          width: 50,\n          height: 50,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 248\n          },\n          __self: this\n        }));\n      })))), React.createElement(\"li\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        href: \"#\",\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, \"Sofa \", React.createElement(\"span\", {\n        className: \"fa arrow\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      })), React.createElement(\"ul\", {\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        maxColumns: 3,\n        \"aria-expanded\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }, sofa.map(function (data) {\n        if (sof > 2) {\n          sof = 0;\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 261\n            },\n            __self: this\n          });\n        }\n\n        sof++;\n        return React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 264\n          },\n          __self: this\n        }, \" \", React.createElement(\"img\", {\n          src: data.img,\n          onClick: function onClick(e) {\n            return _this3.handleClick(data.id);\n          },\n          width: 50,\n          height: 50,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 264\n          },\n          __self: this\n        }));\n      })))), React.createElement(\"li\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        href: \"#\",\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270\n        },\n        __self: this\n      }, \"Kitchen \", React.createElement(\"span\", {\n        className: \"fa arrow\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270\n        },\n        __self: this\n      })), React.createElement(\"ul\", {\n        \"aria-expanded\": \"false\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        maxColumns: 3,\n        \"aria-expanded\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, kit.map(function (data) {\n        if (ki > 2) {\n          ki = 0;\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 277\n            },\n            __self: this\n          });\n        }\n\n        ki++;\n        return React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 280\n          },\n          __self: this\n        }, \" \", React.createElement(\"img\", {\n          src: data.img,\n          onClick: function onClick(e) {\n            return _this3.handleClick(data.id);\n          },\n          width: 50,\n          height: 50,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 280\n          },\n          __self: this\n        }));\n      }))))))))))));\n    }\n  }]);\n\n  return Menu;\n}(Component);\n\nfunction updateAttachPointPosition(groupId) {\n  attachPointLocation[groupId] = {};\n  var pointIds = groupIdAttachIdsMap[groupId];\n\n  if (pointIds) {\n    pointIds.forEach(function (id) {\n      var transformInfo = clara.scene.getWorldTransform(id);\n      attachPointLocation[groupId][id] = new THREE.Vector3().setFromMatrixPosition(transformInfo);\n    });\n  }\n}\n\n;\n\nfunction importScene() {\n  // dong nay labac buoc phai co, tai no copy cai scene cua minh bang id, roi tao mot scene moi.\n  clara.sceneIO.fetch(importSceneId).then(function () {\n    // dong nay tao cai id moi co cai scene minh moi copy\n    var newObjectsIds = clara.scene.find({\n      from: {\n        id: importSceneId\n      },\n      name: 'Objects'\n    }); //code de copy cai scene\n\n    clara.scene.clone({\n      from: {\n        id: newObjectsIds\n      },\n      type: ['PolyMesh', 'Null']\n    }, {\n      withNull: 'Import Null',\n      includeDependencies: true\n    }).then(function (nodeMap) {\n      clara.scene.set( //cai nay set position cho cai scene luc minh add vao\n      {\n        id: nodeMap['Import Null'],\n        plug: 'Transform',\n        property: 'translation'\n      }, {\n        x: 0.12,\n        y: 0,\n        z: -0.12 //y: numImports++ / 2\n\n      });\n    });\n    clara.scene.find({\n      name: 'Objects'\n    }).name = 'BoxGroup';\n  });\n}\n\nfunction findParentGroupId(selectId) {\n  var groupId = selectId;\n  var nodeName = clara.scene.get({\n    id: groupId,\n    property: 'name'\n  });\n\n  while (nodeName !== 'BoxGroup') {\n    if (!nodeName) return null;\n    groupId = clara.scene.find({\n      id: groupId,\n      parent: true\n    });\n    nodeName = clara.scene.get({\n      id: groupId,\n      property: 'name'\n    });\n  }\n\n  return groupId;\n}\n\n;\n\nfunction scaleFunc() {\n  clara.commands.activateCommand('nodeScale');\n}\n\nfunction saveRender() {\n  var id = clara.scene.find({\n    name: 'Objects'\n  });\n  clara.commands.setCommandOptions('snapshot', {\n    dataType: 'download image',\n    camera: 'default',\n    width: 1000,\n    height: 800\n  });\n  var items = clara.commands.runCommand('snapshot');\n\n  if (items) {\n    var resultImage = document.getElementById('resultImage');\n    resultImage.src = URL.createObjectURL(items);\n  }\n}\n\nfunction rand(to, from) {\n  return Math.floor(Math.random() * from + to);\n} //this method adding object to the scene\n//this method delete the object from the scene. All object have to be name: BoxGroup\n\n\nfunction clearScene() {\n  clara.sceneGraph.deleteNode(mouseID.substring(1, mouseID.length - 1));\n} //This function helps rotating object. Need to improve the performance of this function.\n\n\nfunction rotateFunc() {\n  clara.commands.activateCommand('nodeRotate');\n} //this function helps to scale the objects\n\n\nexport default withFirebase(Menu);","map":{"version":3,"sources":["C:\\Users\\nguye\\Downloads\\New folder\\src\\components\\Test\\menu.js"],"names":["React","Component","idScence","Container","Row","Col","withFirebase","$","MetisMenu","Button","claraService","ClaraPlayer","sced","clara","sceneId","importSceneId","mouseID","groupId","THREE","groupIdAttachIdsMap","attachPointLocation","bed","bedimg","chair","sofa","kit","result","Menu","props","createRef","canvas","state","items","id","importScene","itemsRef","firebase","database","ref","on","snapshot","furnitures","val","newState","item","furni","i","push","name","img","claraContainerRef","refs","ref1","claraplayer","deps","rotate","opts","displayGizmo","mode","plane","normal","x","y","z","constant","player","setProgressBar","console","log","window","sceneIO","fetchAndUse","then","showTool","removeTool","selection","setHighlighting","commands","addCommand","enabled","active","tool","click","ev","selectId","filterNodesFromPosition","findParentGroupId","JSON","stringify","deselectAll","activateCommand","selectNode","onChange","updateAttachPointPosition","setCommandOptions","setState","metisMenu","toggle","includes","count","cha","sof","ki","width","height","rotateFunc","scaleFunc","clearScene","saveRender","map","data","e","handleClick","pointIds","forEach","transformInfo","scene","getWorldTransform","Vector3","setFromMatrixPosition","fetch","newObjectsIds","find","from","clone","type","withNull","includeDependencies","nodeMap","set","plug","property","nodeName","get","parent","dataType","camera","runCommand","resultImage","document","getElementById","src","URL","createObjectURL","rand","to","Math","floor","random","sceneGraph","deleteNode","substring","length"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {idScence} from './index.js';\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport {withFirebase} from '../../server/Firebase/index';\nimport $ from 'jquery';\nimport MetisMenu from 'metismenu/src';\nimport './clara.css';\nimport {Button} from \"reactstrap\";\nimport claraService from \"./Clara\";\nimport {ClaraPlayer} from \"./ClaraPlayer\";\nimport sced from './utils';\n\nlet clara;\n\nlet sceneId =  \"921754c6-d081-4e97-af23-178124591393\";\n//clara.sceneIO.fetchAndUse(sceneId);\nlet importSceneId = 'f85ef7a2-6aaa-4333-ba69-1e8f121c4706';\nlet mouseID = \"\";\nlet groupId = \"\";\nvar THREE = \"\";\nvar groupIdAttachIdsMap = {};\nvar attachPointLocation = {};\nvar bed = [];\nvar bedimg = [];\nvar chair = [];\nvar sofa = [];\nvar kit = [];\nvar result = [];\n\nclass Menu extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.clara = React.createRef();\n\t\tthis.canvas = React.createRef();\n    this.state = {\n      items: [],\n      clara: clara\n    }\n\t}\n\n      handleClick(id){\n        importSceneId = id;\n        importScene();\n     }\n\n     componentDidMount() {\n         const itemsRef  = this.props.firebase.database.ref('itemImg');\n\n         itemsRef.on('value', (snapshot) => {\n           var result: [];\n           let furnitures = snapshot.val();\n           let newState = [];\n\n           for (let item in furnitures) {\n             var furni = furnitures[item];\n             for(let i in furni){\n               newState.push({\n                 name: i,\n                 id: furni[i].id,\n                 img: furni[i].img\n                 });\n             }\n\n           }\n           let claraContainerRef = this.refs.ref1;\n           clara = claraService.claraplayer(claraContainerRef);\n\n        //var api = claraplayer('player');\n           THREE = clara.deps.THREE;\n           var rotate = \"\";\n           var opts = {\n             displayGizmo: false,\n             mode: 'plane',\n             plane: {normal: {x: 0, y: 1, z: 0}, constant: 0},\n           }\n           clara.player.setProgressBar('line');\n        //This function is for moving object\n\t\t\t\tconsole.log(window.sced);\n\t\t\t\tsceneId = window.sced;\n         clara.sceneIO.fetchAndUse(sceneId).then(function() {\n\n           clara.player.showTool('nodeMove');\n           clara.player.removeTool('select');\n           clara.selection.setHighlighting(true);\n\n           clara.commands.addCommand({\n            enabled: true,\n            active: true,\n            tool: {\n              click: function(ev) {\n                var selectId = clara.player.filterNodesFromPosition(ev);\n               console.log(selectId);\n                groupId = findParentGroupId(selectId[0]);\n                mouseID = JSON.stringify(groupId);\n                if (!selectId || !groupId) {\n                  clara.selection.deselectAll();\n                  clara.commands.activateCommand('orbit');\n                } else {\n                  clara.selection.selectNode(groupId);\n                  console.log('this is object id: ', groupId);\n                  clara.commands.activateCommand('nodeMove');\n                  opts.onChange = updateAttachPointPosition(groupId);\n                  clara.commands.setCommandOptions('nodeMove', opts);\n                }\n              },\n            },\n          });\n        });\n\n           this.setState({\n             items: newState,\n             clara: clara\n           });\n         });\n\n         $('#menu').metisMenu({\n           toggle: false\n         });\n\n\n       }\n\n\n\n\n\t//save\n\n\n    render() {\n      result = this.state.items;\n      for(var i in result){\n        if(result[i].name.includes(\"bed\")){\n          bed.push(result[i]);\n        }else if(result[i].name.includes(\"sofa\")){\n          sofa.push(result[i]);\n        }else if(result[i].name.includes(\"kit\")){\n          kit.push(result[i]);\n        }else if(result[i].name.includes(\"chair\")){\n          chair.push(result[i]);\n        }\n      }\n      var count = 0;\n      var cha = 0;\n      var sof = 0;\n      var ki = 0;\n      return (\n        <Container>\n        <Row>\n        <Col>\n        \t\t\t\t<h1>Home Page</h1>\n        \t\t\t\t<div\n        \t\t\t\t\tid=\"container\"\n        \t\t\t\t\tstyle={{width: \"800px\", height: \"600px\"}}\n        \t\t\t\t\tref=\"ref1\"\n        \t\t\t\t/>\n        \t\t\t\t<Button className=\"btn\"\n        \t\t\t\t\tvariant=\"primary\"\n        \t\t\t\t\ttype=\"button\"\n        \t\t\t\t\tonClick={() => {\n        \t\t\t\t\t\timportScene();\n        \t\t\t\t\t}}\n        \t\t\t\t>\n        \t\t\t\t\tImport\n        \t\t\t\t</Button>\n        \t\t\t\t<Button className=\"btn\"\n        \t\t\t\t\tvariant=\"primary\"\n        \t\t\t\t\ttype=\"button\"\n        \t\t\t\t\tonClick={() => {\n        \t\t\t\t\t\trotateFunc();\n        \t\t\t\t\t}}\n        \t\t\t\t>\n        \t\t\t\t\tRotate\n        \t\t\t\t</Button>\n\n        \t\t\t\t<Button className=\"btn\"\n        \t\t\t\t\tvariant=\"primary\"\n        \t\t\t\t\ttype=\"button\"\n        \t\t\t\t\tonClick={() => {\n        \t\t\t\t\t\tscaleFunc();\n        \t\t\t\t\t}}\n        \t\t\t\t>\n        \t\t\t\t\tScale\n        \t\t\t\t</Button>\n\n        \t\t\t\t<Button className=\"btn\"\n        \t\t\t\t\tvariant=\"primary\"\n        \t\t\t\t\ttype=\"button\"\n        \t\t\t\t\tonClick={() => {\n        \t\t\t\t\t\tclearScene();\n        \t\t\t\t\t}}\n        \t\t\t\t>\n        \t\t\t\t\tDelete\n        \t\t\t\t</Button>\n\n        \t\t\t\t<Button\n        \t\t\t\t\tvariant=\"primary\"\n        \t\t\t\t\ttype=\"button\"\n        \t\t\t\t\tonClick={() => {\n        \t\t\t\t\t\tsaveRender();\n        \t\t\t\t\t}}\n        \t\t\t\t>\n        \t\t\t\t\tDownload\n        \t\t\t\t</Button>\n\n        \t\t\t</Col>\n              <Col>\n              </Col>\n\n\n        <Col>\n        <h1>This is a demo</h1>\n        <br/>\n        <br/>\n        <div className=\"row\">\n          <div className=\"col-xs-6\">\n            <aside className=\"sidebar\">\n              <nav className=\"sidebar-nav\">\n                <ul className=\"metismenu\" id=\"menu\">\n                  <li>\n                    <a href=\"#\" aria-expanded=\"false\">Bed <span className=\"fa arrow\" /></a>\n                    <ul aria-expanded=\"false\">\n                    <table maxColumns={3} aria-expanded=\"true\">\n                      {\n                        bed.map(data => {\n                        if(count > 2){\n                          count = 0;\n                          return <tr></tr>\n                        }\n                        count++;\n                        return <td> <img src={data.img}  onClick={(e) => this.handleClick(data.id)} width={50} height={50}/></td>\n                      })}\n                    </table>\n                    </ul>\n                  </li>\n                  <li>\n                    <a href=\"#\" aria-expanded=\"false\">Chair <span className=\"fa arrow\" /></a>\n                    <ul aria-expanded=\"false\">\n                    <table maxColumns={3} aria-expanded=\"true\">\n                      {\n                        chair.map(data => {\n                        if(cha > 2){\n                          cha = 0;\n                          return <tr></tr>\n                        }\n                        cha++;\n                        return <td> <img src={data.img}  onClick={(e) => this.handleClick(data.id)} width={50} height={50}/></td>\n                      })}\n                    </table>\n                    </ul>\n                  </li>\n                  <li>\n                    <a href=\"#\" aria-expanded=\"false\">Sofa <span className=\"fa arrow\" /></a>\n                    <ul aria-expanded=\"false\">\n                    <table maxColumns={3} aria-expanded=\"true\">\n                      {\n                        sofa.map(data => {\n                        if(sof > 2){\n                          sof = 0;\n                          return <tr></tr>\n                        }\n                        sof++;\n                        return <td> <img src={data.img}  onClick={(e) => this.handleClick(data.id)} width={50} height={50}/></td>\n                      })}\n                    </table>\n                    </ul>\n                  </li>\n                  <li>\n                    <a href=\"#\" aria-expanded=\"false\">Kitchen <span className=\"fa arrow\" /></a>\n                    <ul aria-expanded=\"false\">\n                    <table maxColumns={3} aria-expanded=\"true\">\n                      {\n                        kit.map(data => {\n                        if(ki > 2){\n                          ki = 0;\n                          return <tr></tr>\n                        }\n                        ki++;\n                        return <td> <img src={data.img}  onClick={(e) => this.handleClick(data.id)} width={50} height={50}/></td>\n                      })}\n                    </table>\n                    </ul>\n                  </li>\n                </ul>\n              </nav>\n            </aside>\n          </div>\n        </div>\n        </Col>\n        </Row>\n        </Container>\n      );\n    }\n  }\n\nfunction updateAttachPointPosition(groupId){\n  attachPointLocation[groupId] = {};\n  var pointIds = groupIdAttachIdsMap[groupId];\n  if (pointIds) {\n    pointIds.forEach(function(id){\n      var transformInfo = clara.scene.getWorldTransform(id);\n      attachPointLocation[groupId][id] = new THREE.Vector3().setFromMatrixPosition(transformInfo);\n    });\n  }\n};\n\nfunction importScene() {\n\t// dong nay labac buoc phai co, tai no copy cai scene cua minh bang id, roi tao mot scene moi.\n\tclara.sceneIO.fetch(importSceneId).then(function() {\n\t// dong nay tao cai id moi co cai scene minh moi copy\n\tvar newObjectsIds = clara.scene.find({ from: { id: importSceneId }, name: 'Objects' });\n\t//code de copy cai scene\n\tclara.scene.clone(\n\t\t{ from: { id: newObjectsIds }, type: ['PolyMesh', 'Null'] },\n\t\t{ withNull: 'Import Null', includeDependencies: true }\n\t).then(function(nodeMap) {\n\t\t\tclara.scene.set(\n\t\t\t\t//cai nay set position cho cai scene luc minh add vao\n\t\t\t\t{ id: nodeMap['Import Null'], plug: 'Transform', property: 'translation' },\n\t\t\t\t{x: 0.12, y: 0, z: -0.12} //y: numImports++ / 2\n\t\t\t);\n\t\t});\n\t\tclara.scene.find({name:'Objects'}).name = 'BoxGroup';\n\t});\n}\nfunction findParentGroupId(selectId){\n  var groupId = selectId;\n  var nodeName = clara.scene.get({id: groupId, property: 'name'});\n  while ( nodeName !== 'BoxGroup' ){\n\n    if (!nodeName) return null;\n    groupId = clara.scene.find({id: groupId, parent: true});\n    nodeName = clara.scene.get({id: groupId, property: 'name'});\n  }\n  return groupId;\n};\n\nfunction scaleFunc() {\n\t\tclara.commands.activateCommand('nodeScale');\n}\n\nfunction saveRender() {\n\t  var id  = clara.scene.find({name:'Objects'});\n\t  clara.commands.setCommandOptions('snapshot', {\n\t    dataType: 'download image',\n\t    camera: 'default',\n\t    width: 1000,\n\t    height: 800,\n\t  });\n\t  var items = clara.commands.runCommand('snapshot');\n\t  if (items) {\n\t    var resultImage = document.getElementById('resultImage');\n\t    resultImage.src = URL.createObjectURL(items);\n\t  }\n\t}\n\n\tfunction rand(to, from) {\n\t  return Math.floor((Math.random() * from) + to);\n\t}\n\n\t//this method adding object to the scene\n\n\t//this method delete the object from the scene. All object have to be name: BoxGroup\n\tfunction clearScene() {\n\t  clara.sceneGraph.deleteNode(mouseID.substring(1,mouseID.length -1 ));\n\t}\n\n\t//This function helps rotating object. Need to improve the performance of this function.\n\tfunction rotateFunc() {\n\t    clara.commands.activateCommand('nodeRotate');\n\t}\n\n\t//this function helps to scale the objects\n\n\n\n\nexport default withFirebase(Menu);\n"]},"metadata":{},"sourceType":"module"}